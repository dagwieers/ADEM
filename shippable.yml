language: c

env:
  global:
  - ARDUINO_VERSION=1.8.5
  matrix:
  - PROJECT=adem
  - PROJECT=i2c-slave

before_install:
# Ensure we have a DISPLAY for the Arduino IDE [WORKAROUND]
- '/sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_1.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :1 -ac -screen 0 1280x1024x16'
- wget -nv http://downloads.arduino.cc/arduino-$ARDUINO_VERSION-linux64.tar.xz
- tar -xJf arduino-$ARDUINO_VERSION-linux64.tar.xz

script:
- >
  DISPLAY=:1.0 PATH="$PATH:$PWD/arduino-$ARDUINO_VERSION"
  arduino
  --pref boardsmanager.additional.urls=http://arduino.esp8266.com/stable/package_esp8266com_index.json
  --pref build.verbose=false
  --pref compiler.warning_level=error
  --pref sketchbook.path=$PROJECT
  --install-boards esp8266:esp8266
  --save-prefs
- >
  DISPLAY=:1.0 PATH="$PATH:$PWD/arduino-$ARDUINO_VERSION"
  arduino --verify --board esp8266:esp8266:thing $PWD/$PROJECT/$PROJECT.ino
